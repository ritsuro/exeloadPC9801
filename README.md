# exeloadPC9801
このプロジェクトの内容は1989年から1993年頃まで、PC-9801上で作りました。  
NEC PC-9801のフロッピーディスク専用のオリジナルDOS『EXELOAD』のソースコードです。  
ゲーム専用OSです。  
8086アセンブラで作られています。  
  
何度か改良を重ねてバージョン番号が上がっています。  
   
この文を書いている時点で、32年以上前のソースコードです。動作の保証はありません。  
参考用として参照してください。  
  
（１）ソースコードは1993年6月21日最新のものでフォルダは

	"IPLSYS"　　　EXELOAD本体です。起動部分のプログラム(IPL)をフロッピーディスクに書き込むIPLSYS.EXEのソースコードです。  
	"EXELOAD"　　PSHELL本体です。一緒に組み込み、DOSとしての命令を拡張します。  

（２）1992年3月頃に作成したドキュメントから引用して、ここに掲載します

	それぞれ  "README.DOC"、"README1.DOC"、"README2.DOC"、"UPDATE.DOC"があります。  

	"README.DOC"　全体の説明です。  
	"README1.DOC"　EXELOAD本体の説明、いわゆるIPL（ディスクから起動させる部分）と簡易ファイラーです。  
	"README2.DOC"　PSHELL本体の説明 、一緒に組み込み、DOSとしての命令を拡張します。  
	"UPDATE.DOC"　　アップデートの記録です。  
	連続して掲載します。  

ここから  

ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  
; "README.DOC" PC-9801UV11 make by R.H 1990/11/23 R.Hashimoto  
;				modify 1990/12/23 R.Hashimoto  
;				modify 1991/01/04 R.Hashimoto  

（１）	ドキュメントの見方

	・超小型ＤＯＳとして使う場合

		ＲＥＡＤＭＥ１．ＤＯＣを参照して
		ＥＸＥＬＯＡＤのみご利用下さい。


	・高度な機能を利用したい。
	（ファイルハンドルを使ったファイル操作等）

		ＲＥＡＤＭＥ１．ＤＯＣと
		ＲＥＡＤＭＥ２．ＤＯＣの
		双方を参照してＥＸＥＬＯＡＤと
		ＰＳＨＥＬＬの両方を利用して下さい。

（２）　テクニカルメモ

	・本製品は標準ＤＯＳに見られるサブディレクトリィの
	　機能はありませんので、予めご了承下さい。

	・本製品を使用する場合は、８０８６マクロアセンブラの
	　知識が必要です。

	・エプソンのＰＣ−２８６／３８６シリーズにも対応しています。

	・新型のエプソンタイプＦＤＣ／ＢＩＯＳにも対応出来るようになり
	　高い互換性を保持しています。

	・ＥＸＥＬＯＡＤ．ＳＹＳはセクタ位置が決まっていますので
	　単体のコピーは出来ません。

	・ＰＳＨＥＬＬ．ＥＸＥは単体でのコピーが可能です。

	・ＥＸＥＬＯＡＤとＰＳＨＥＬＬの組み合せは
	　ＤＯＳのコア（核）をＥＸＥ形式に独立させることを
	　可能にしました。

	・ＥＸＥＬＯＡＤ．ＳＹＳはＰＳＨＥＬＬ．ＥＸＥを
	　ロードする時、自らの領域をロードエリアにするので
	　無駄がありません。

	・改造する時は次のことに注意して下さい。

		CODSYS.ASM の CHASH_BUFFER1 と
		READWT.ASM の CHASH_BUFFER1 が絶対番地の
		１００００Ｈ，２００００Ｈ，３００００Ｈ
		４００００Ｈ，５００００Ｈ，６００００Ｈ
		７００００Ｈ，８００００Ｈ，９００００Ｈ
		Ａ００００Ｈ，Ｂ００００Ｈ，Ｃ００００Ｈ
		Ｄ００００Ｈ，Ｅ００００Ｈ，Ｆ００００Ｈ
		にまたがらないように、注意して下さい。
		また、必ず偶数番地からスタートするように
		して下さい。これはＤＭＡの制約からくる
		ものです。

		ちなみに、ＥＸＥＬＯＡＤ．ＳＹＳとＰＳＨＥＬＬ．ＥＸＥ
		のロードアドレスは約６００Ｈ番地になっています。

	・ＰＳＨＥＬＬのコマンド

		ＤＩＲ		ディレクトリィ一覧（ワイルドカードは不可）
		ＴＹＰＥ	タイプ
		ＨＥＬＰ	コマンド一覧
		ＣＴＲＬ−Ｃ	強制終了
		ＣＴＲＬ−Ｓ	一時停止
		ＣＴＲＬ−Ｑ	一時停止の解除


（重要）・ＰＳＨＥＬＬのサイズ

		ＰＳＨＥＬＬ．ＡＳＭの約１６行目に
		ＰＳＨＥＬＬ．ＥＸＥのパラグラフサイズ
		が入っています。
		改造時にはリンクマップを参照して変更を
		忘れないようにして下さい。
		（若干の余裕を持たせるのがコツ）

		MY_SYSTEM_SIZE	DW　0C00H　; このプログラムのサイズ

		リンクマップ
		Start  Stop   Length Name                   Class
		00000H 02B01H 02B02H CODE                   CODE
		02B10H 0745BH 0494CH DATA                   DATA
		07460H 07C2FH 007D0H STACK                  
		07C30H 0BC33H 04004H CHASHB                 CHASHB
		       ------これにＥＸＥのヘッダサイズを
		       加算したのがプログラムサイズです。

	・ＥＸＥＬＯＡＤのシステムロードサイズ（ＩＰＬ以外のシステム）

		改造によりシステムサイズ（EXELOAD.SYSのサイズ）
		が大きくなったときは
		CODIPL.ASM の SYS_SEC_CNT（システムセクタのセクタ数）
		を増やして下さい。（１０２４バイトの倍数）

;  
;	end of "README.DOC"  
;  
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  
; "README1.DOC" PC-9801UV11 make by R.H 1990/03/22   E X E L O A D .  
;                              ver 0.22 1990/03/22   E X E L O A D .  
;                              ver 0.23 1990/11/23   E X E L O A D .  
;                              .DOC     1991/01/04   E X E L O A D .  
;                              ver 0.25 1991/12/28   E X E L O A D .  

はじめに．  
  
　　このソフトはＰＣ−９８０１でゲームを標準ＤＯＳ無しでたちあげるために開発したポータブルＤＯＳ「ＥＸＥＬＯＡＤ」です。  
  
　　このソフトを使うときにはつぎの使用権を守ってください。  
  
	    １）バグは自分で取る  
	    ２）バージョンアップは自分でやる  
	    ３）作者は本業でいそがしい  
	    ４）ＢＡＳＩＣはたちあがらない  
	    ５）アセンブラ  
	    ６）ともだちにもタダであげる  
  
　　このＤＯＳは標準ＤＯＳのＥＸＥ形式をロードするリロケータブルローダだから開発が簡単だよ。'AUTOEXEC.EXE'としておけばたちあがるよ。  
  
　小学生高学年用マニュアル  


１．では始めましょう  
  
　　天才は５分で終わるよ。  
　　８０８６アセンブラを知らない人、◯◯時間。  
　　◯◯・・・。  
  
２．ファイルはありますか？  

　　この作業に必要なファイルは下に書いた１０個です。  
  
	    TSTSET   INC     3577  89-11-22   21:44  
	    CODIPL   ASM     8483  90-10-05    1:01  
	    CODSYS   ASM    50886  90-10-11   19:37  
	    CONSOLE  ASM     9684  89-11-19    2:09  
	    IPLSYS   ASM     1660  90-07-17   18:19  
	    MACLIB   ASM     8672  89-11-22   21:43  
	    SCWRT    ASM     6357  89-12-04    2:27  
	    SYSSET   ASM    10304  90-10-04    1:50  
	    ALL      BAT      108  90-03-22   11:04  
	    IPLSYSL  BAT       57  89-12-02   12:56  
  
３．とりあえず、ＥＸＥを作ろう。  

　　カレントで８０８６マクロアセンブラとリンカが使えるように用意してね。  

　　'ALL.BAT'を実行すると 'IPLSYS.EXE'が３分位で出来上がるよ。  
  
４．システムディスクをつくるよ。  

　　ＥＸＥもできて、いよいよシステムディスクを作るときが来ましたね。  

　　まず、１ＭｂｙｔｅＦＤを１枚、ひょうじゅんＤＯＳでフォーマットしてください。  

　　例）  
　　　　　A> FORMAT B:（ＲＥＴＵＲＮキー）  
  
　　つぎに、'IPLSYS.EXE'を走らせてください。  
  
　　例）  
　　　　　A> IPLSYS （ＲＥＴＵＲＮキー）  
  
　　すると、メッセージが出ます。  
　　ーーーーーーーーーーーーーーーーーーーー  
　　｜システムの書き込み  
　　｜１ＭＦＤドライブ番号は？（１、２、３、４）  
　　｜  
　　｜  
　　｜  
  　　
　　そうしたら、さっきフォーマットした１ＭｂｙｔｅＦＤをどこかのドライブに入れて、そのほかのディスクは全部ぬいてください。  
  
　　いよいよディスクにシステムをかきこむよ。ＦＤのはいっているドライブ番号をキーで入力してね。  
  
　　ーーーーーーーーーーーーーーーーーーーー  
　　｜システムの書き込み  
　　｜１ＭＦＤドライブ番号は？（１、２、３、４）1  
　　｜１ＭＦＤドライブにシステムを書き込みますか？（Ｑ＝やっやだ！やめてぇ）  
　　｜  
　　｜  

　　このメッセージが出たら、あとはリターンキーを押すだけです。  

　　ーーーーーーーーーーーーーーーーーーーー  
　　｜システムの書き込み  
　　｜１ＭＦＤドライブ番号は？（１、２、３、４）1  
　　｜１ＭＦＤドライブにシステムを書き込みますか？（Ｑ＝やっやだ！やめてぇ）  
　　｜ＩＰＬコードのサイズ＝00627  
　　｜システムコードのサイズ＝02969  
　　｜システム転送成功しました  
　　｜  
　　｜  
  
　　このあとＦＤのドアの開閉をしてちょっ！  
　そうしないと標準ＤＯＳがディレクトリィを読んでくれないの。  
  
５．自分の作ったＥＸＥをコピーしてたちあげてみよう。  
  
 　自分の作ったＥＸＥは'AUTOEXEC.EXE'という名前にしておけば、たちあがるよ。  
  
　　ためしにさっき作った'IPLSYS.EXE'をコピーしてみようよ。  
  
　　例）  
　　　　　A> COPY IPLSYS.EXE B:AUTOEXEC.EXE（ＲＥＴＵＲＮキー）  
  
　　ＤＩＲをするとコピーされたのがわかるよね。  
  
　　ーーーーーーーーーーーーーーーーーーーー  
　　｜A> DIR B:  
　　｜  
　　｜ ドライブ B: のディスクのボリュームラベルはありません.  
　　｜ ディレクトリは B:¥  
　　｜  
　　｜EXELOAD  SYS    2799  
　　｜AUTOEXEC EXE    56796  90-10-11   19:38  
　　｜        2 個のファイルがあります.  
　　｜    1189888 バイトが使用可能です.  
　　｜  
  
　　このディスクをセットしてたちあげれば、さっきのメッセージがでるよ。  
  
  
  
６．ファイルを読む  
  
　　やっぱりパソコンプログラマ、ファイルぐらい読みたいよね。だいじょうぶ！  
  このシステムにもファイルを読むためのシステムコールはあるんだよ。  
  ＦＣＢを使ってＯＰＥＮするおなじみの方式なんだ。ＦＣＢをいじれないようじゃ一人前とはいえないよね。  
  ファンクション一覧を書いておくね。  
  
　　ただし、同時にオープン出来るファイルの数は一つだけなので気をつけてね。  
　（えっ、それじゃＦＣＢの意味がないって自分で改造してね・・・）  
  
・ファイルのオープン  
  
　　ＩＮＴ　２１Ｈ  

　　ＡＨ　　　　＜−　０ＦＨ  
　　ＤＳ：ＤＸ　＜−　オープンされていないＦＣＢのアドレス  
  
　リターン値  
　　ＡＬ　　　　＜−　００Ｈ　  
　　　　　　　　　　　ＦＦＨ　ファイルがない  
  
・ファイルのクローズ  
  
　　ＩＮＴ　２１Ｈ  
  
　　ＡＨ　　　　＜−　１０Ｈ  
　　ＤＳ：ＤＸ　＜−　オープンされているＦＣＢのアドレス  
  
　リターン値  
　　ＡＬ　　　　＜−　００Ｈ　正常にクローズできた  
  
・シーケンシャルリード（１ｂｙｔｅから６４Ｋｂｙｔｅまで可能）  
  
　　ＩＮＴ　２１Ｈ  
  
　　ＡＨ　　　　＜−　１４Ｈ  
　　ＤＳ：ＤＸ　＜−　オープンされているＦＣＢのアドレス  
  
　リターン値  
　　ＡＬ　　　　＜−　０＝正常，１＝Ｅ．Ｏ．Ｆ（もう続きのデータは無い）  
　　　　　　　　　　　２＝ディスクエラー  
  
・ＤＴＡのセット（６４Ｋｂｙｔｅまで可能）  
　　　　　　　（データバッファのことだよ）  
  
　　ＩＮＴ　２１Ｈ  
  
　　ＡＨ　　　　＜−　１ＡＨ  
　　ＤＳ：ＤＸ　＜−　新しいＤＴＡのアドレス  
  
  
７．プロセス管理について  
  
　　プロセスを別のＥＸＥへ引き継ぐコマンドつまり、別のＥＸＥを立ち上げる方法もサポートしているよ。
  
　　１）　ＤＳ：［ＤＸ］＝次の実行ファイル名アドレスをセットする。（１１文字）  
  
　　２）　ＭＯＶ　　ＡＨ，４ＣＨ  
　　　　　ＩＮＴ　　２１Ｈ　　　　（プロセスの終了？）を実行する。  
  
　　３）　ＤＸにロードドライブ番号（０ー３）をセットして  
　　　　　ＣＳ＝６０Ｈ，ＩＰ＝０番地へ飛べば実行ファイルを起動するよ。  
  
	    JMP　　DWORD PTR START_ADDRESS 　　; スタートアドレス  
  
	    START_ADDRESS　　LABEL　DWORD　　　; スタートアドレス  
	    START_OFFSET　　 DW 0　　　　　　　; スタートオフセットアドレス  
	    START_SEG　　　　DW 60H　　　　　　; スタートセグメントアドレス  
  
;  
;	end of "README1.DOC"  
;  
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  
; "README2.DOC" PC-9801UV11 make by R.H 1990/11/23 R.Hashimoto  
;				 modify 1991/01/04 R.Hashimoto  
;				 modify 1991/06/28 R.Hashimoto  


	EXELOAD ver0.25 (C) R.Hashimoto 1989,1990,1991 in shimorenjaku.  
	PSHELL  ver0.14 (C) R.Hashimoto 1989,1990,1991 in shimorenjaku.  

	ＥＸＥＬＯＡＤ　ｖｅｒ０．２５  
	ＰＳＨＥＬＬ　　ｖｅｒ０．１４  


（０）	本製品は、使用時のライセンス料は無料です。
	コピーおよび配布なども自由です。
	改造、改良、組み込み、掲載も自由です。

	ただし、本プログラムのソースコードおよび
	実行形式ファイルなどの、著作権と配布の権利
	販売の権利を、阻害する行為は絶対にやめて下さい。
	使用者全員がたいへん迷惑します。

	本製品（ＥＸＥＬＯＡＤとＰＳＨＥＬＬ）
	は、今後もいっさいのライセンス料は無料にします。

	本製品を改造してオリジナルＤＯＳとして製品化して
	ジャンジャン売って一億円もうけても構いません。
	ただし、そのときはＥＸＥＬＯＡＤとＰＳＨＥＬＬの
	メッセージは使用しないでくださいね。

	製作者　


（１）	はじめに

	ＥＸＥＬＯＡＤとＰＳＨＥＬＬは標準ＤＯＳ上で
	制作したゲームプログラムを修正を加えずに
	そのまま１ＭｂｙｔｅＦＤ上で立ち上げ実行する
	ために作った簡易ＤＯＳシステムです。


（２）　組み込み方法

	１．まず、２ＨＤのフロッピーディスクを標準ＤＯＳ
	　　でＦＯＲＭＡＴします。

	２．つぎに、ＥＸＥＬＯＡＤを組み込みます。

		ＥＸＥＬＯＡＤの組み込み方

		ＩＰＬＳＹＳを実行して
		ドライブにＦＯＲＭＡＴしたディスクをセットして
		そのドライブに対して書き込みを行います。
		（詳しくは、ＲＥＡＤＭＥ１．ＤＯＣを参照して下さい）

	ＩＰＬＳＹＳの使用例

	システムの書き込み
	１ＭＦＤドライブ番号は？（１、２、３、４）1
	１ＭＦＤドライブにシステムを書き込みますか？（Ｑ＝やっやだ！やめてぇ）
	ＩＰＬコードのサイズ＝00629
	システムコードのサイズ＝02799
	システム転送成功しました

	３．ＥＸＥＬＯＡＤ．ＳＹＳの組み込みが終わったら
	　　フロッピーディスクを一回ドライブから取り出して
	　　下さい。
	　　（システムの書き込みは直接ＢＩＯＳをコールしているので）


	４．ＰＳＨＥＬＬ．ＥＸＥをＣＯＰＹします。

	５．これでできあがりです。
	　　ディスク内容はつぎのようになります。

		EXELOAD  SYS     2969
		PSHELL   EXE    48660  90-11-23   11:28
		        2 個のファイルがあります.
	  1198080 バイトが使用可能です.


（３）　プログラムの組み込み

	ＡＵＴＯＥＸＥＣ．ＥＸＥを
	自動立ち上げします。

	音楽ドライバーＰＭＤ９８を常駐することができます。
	ＰＭＤ．ＣＯＭをコピーするだけです。


（４）　ファンクション２１Ｈ

	ＩＮＴ２１Ｈでサポートされる機能は
	次の通りです。


	プログラムの終了
		ＡＨ＝００Ｈ

	１文字出力
		ＡＨ＝０２Ｈ
		入力	DL : 出力する文字

	コンソール入出力
		ＡＨ＝０６Ｈ
		入力	DL : 0FFH ならば１文字入力 0FFH以外ならば
				DL=出力する文字
		出力	AL : 入力文字
			zf : off:入力なし,on:入力あり

	文字列の出力

		ＡＨ＝０９Ｈ
		入力	DS:DX : 文字列 ('$':文字列の終わり)

	文字列の入力

		ＡＨ＝０ＡＨ
		入出力	DS:DX : バッファ
			+0:最大入力文字列（ＣＲも含む）
			+1:実際の入力された文字数（ＣＲを含まない）
	        	+2:入力された文字列

	ディスクのリセット

		ＡＨ＝０ＤＨ

	ＦＣＢファイルオープン

		ＡＨ＝０ＦＨ
		入力	DS:DX : 初期化されたユーザＦＣＢ
		出力	AL    : 0=正常, FFh=ファイルがない


	ＦＣＢファイルクローズ

		ＡＨ＝１０Ｈ
		入力	DS:DX : オープン中のユーザＦＣＢ
		出力	AL    : 0=正常, FFh=クローズ出来ない

	ＦＣＢファイルＲＥＡＤ

		ＡＨ＝１４Ｈ
		入力	DS:DX : オープン中のユーザＦＣＢ
		出力	AL    : 0=正常
			      : 1=Ｅ．Ｏ．Ｆ（もう続きのデータは無い）
			      : 2=ディスクエラー
	ＤＴＡセット

		ＡＨ＝１ＡＨ
		入力	DS:DX : セットするＤＴＡのアドレス


	プロセスの常駐

		ＡＨ＝３１Ｈ
		入力	DX : 確保パラグラフ値

	ディスクの空き容量
		ＡＨ＝３６Ｈ
		入力	DL : 0=カレントドライブ,1=A:,2=B:...
		出力	AX : セクタ数／１クラスタ,ドライブが無効のときはFFFFh
			BX : 空きクラスタ数
			CX : バイト数／１セクタ
			DX : クラスタ数／１ドライブ

	ハンドルクリエイト

		ＡＨ＝３ＣＨ
		入力	DS:DX : ハンドル名
		出力	cf    : off:正常,on:異常
			AX    : cf=off: ファイルハンドル
				cf=on : 3=ハンドル名が無効

	ハンドルのオープン

		ＡＨ＝３ＤＨ
		入力	DS:DX : ハンドル名
		出力	cf    : off:正常,on:異常
			AX    : cf=off: ファイルハンドル
			      : cf=on : 2=ファイルがない

	ハンドルのクローズ

		ＡＨ＝３ＥＨ
		入力	BX : ファイルハンドル
		出力	cf : off:正常,on:異常
			AX : cf=on : 6=ファイルハンドルが無効

	ハンドルのＲＥＡＤ

		ＡＨ＝３ＦＨ
		入力	DS:DX : バッファのアドレス
			CX    : 読み込みバイト数
			BX    : ファイルハンドル
		出力	cf    : off:正常,on:異常
			AX    : cf=off: 読み込めたバイト数。ＥＯＦならば０
			      : cf=on : 6=ファイルハンドルが無効

	ハンドルのＷＲＩＴＥ

		ＡＨ＝４０Ｈ
		入力	DS:DX : データバッファのアドレス
			CX    : 書き込みバイト数
			BX    : ファイルハンドル
		出力	cf    : off:正常,on:異常
			AX    : cf=off: 書き込めたバイト数。
			      : cf=on : 6=ファイルハンドルが無効

	ファイルの削除

		ＡＨ＝４１Ｈ
		入力	DS:DX : パス名
		出力	cf    : off:正常,on:異常
			AX    : cf=on : 02H=指定パスが無効


	ファイル・ポインタの移動（ＲＥＡＤ時のみです）

		ＡＨ＝４２Ｈ
		入力	AL    : 移動モード
				（0:先頭から,1:現在位置から,2:終端から）
			BX    : ファイルハンドル
			CX:DX : 移動するバイト数
		出力	cf    : off:正常,on:異常
			cf=off の場合
			DX:AX : 移動後の位置（先頭からのバイト数）
			cf=on  の場合
			AX    : 01H=移動モードが無効
			      : 06H=ファイルハンドルがオープンされていない

	メモリの割り当て

		ＡＨ＝４８Ｈ
		入力	BX       : 割り当てるメモリサイズ（パラグラフサイズ）
		出力	cf       : off:正常,on:異常
			cf=0  AX : 割り当てられたフリーエリアの先頭セグメント
			cf=1  AX : 08H=空きメモリが足りない
			cf=1  BX : フリーエリアのサイズ（パラグラフサイズ）

	メモリの開放

		ＡＨ＝４９Ｈ
		入力	ES : 開放するメモリのパラグラフ値


	メモリの割り当ての変更

		ＡＨ＝４ＡＨ

		入力	ES	: メモリ領域のセグメント値
			BX	: 割り当てるメモリサイズ（パラグラフサイズ）
		出力	cf	: off:正常,on:異常
			cf=1 AX	: 08H=メモリが足りない
			cf=1 BX	: 最大サイズ（パラグラフサイズ）


	プロセスの終了

		ＡＨ＝４ＣＨ


	ＰＳＰアドレスの取得

		ＡＨ＝６２Ｈ

		出力	BX : ＰＳＰセグメント値


（５）　テクニカルメモ

	・本ソースプログラムはＭＡＳＭｖｅｒ５．１でアセンブル
	　できます。リンカはＭＳ−ＬＩＮＫを使用しています。

	・構造体定義やレコード、マクロ内のＩＦ分等、
	　複雑な定義は一切使っていません。

	・ＭＡＫＥＦＩＬＥはＭＳ−ＭＡＫＥ(Version 4.07)で実行出来ます。

	・シェル上のコマンドはＨＥＬＰで一覧を見ることが出来ます。

	・標準ＤＯＳに見られるサブディレクトリィの機能はありません。

	・いまのところ、書き込み中／読み込み中の２つのハンドルのみ
	　サポートします。従って同時にオープンできるファイル数は
	　ＲＥＡＤ／ＷＲＩＴＥともに一つずつです。

（重要）・ＰＳＨＥＬＬのサイズ

		ＰＳＨＥＬＬ．ＡＳＭの約１６行目に
		ＰＳＨＥＬＬ．ＥＸＥのパラグラフサイズ
		が入っています。
		改造時にはリンクマップを参照して変更を
		忘れないようにして下さい。
		（若干の余裕を持たせるのがコツ）

		MY_SYSTEM_SIZE	DW 0D00H ; このプログラムのサイズ（パラグラフ）

		リンクマップ
		Start  Stop   Length Name                   Class
		00000H 03011H 03012H CODE                   CODE
		03020H 079FBH 049DCH DATA                   DATA
		07A00H 081CFH 007D0H STACK                  
		081D0H 0C21FH 04050H CHASHB                 CHASHB
		       ------これにＥＸＥのヘッダサイズを
		       加算したのがプログラムサイズです。


	・メモリ管理が出来ますが、機構は単純なフラットなもので
	　ブロックは持っていません。下記の５つのパラメータのみで
	　管理されているだけです。

		"SSADRS.ASM"

		ADRS_MIN	; 空きエリア（パラグラフ）下限
		ADRS_MAX	; 空きエリア（パラグラフ）上限＋１ (A000H)
		ADRS_PSP	; ＰＳＰエリア（パラグラフ）
		ADRS_PNEXT	; プログラムの直後エリア（パラグラフ）
		ADRS_FRE	; 空きエリア（パラグラフ）先頭


	・ＥＸＥＬＯＡＤのシステムロードサイズ（ＩＰＬ以外のシステム）

		改造によりシステムサイズ（EXELOAD.SYSのサイズ）
		が大きくなったときは
		CODIPL.ASM の SYS_SEC_CNT（システムセクタのセクタ数）
		を増やして下さい。（１０２４バイトの倍数）

	・ＲＥＡＤＭＥ．ＤＯＣの「テクニカルメモ」も
	　参照しておいて下さい。

;  
;	end of "README2.DOC"  
;  
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  
; "UPDATE.DOC" PC-9801UV11 make by R.H 1991/01/16 R.Hashimoto  
;  
;	１９９１／０１からの歴史  
;  

1991/01/16 EXELOAD.SYS / CODIPL.ASM

	ＥＰＳＯＮ　ＰＣ−３８６ＬＳＸの
	３．５ｉｎｃｈドライブ対策の為、リトライ回数を
	５回から１０回に変更した。
		READ_RETCOUNT 	EQU	10	; リード・リトライ回数
	このドライブは冬季、電源ＯＮ時から回転が安定するまで、
	時間がかかるようだ。

1991/01/17 PSHELL.EXE

	ＰＳＰアドレスの取得	ＡＨ＝６２Ｈ

	その他			ＡＨ＝４８Ｈ
				ＡＨ＝４９Ｈ
				ＡＨ＝４ＡＨ

1991/01/30 PSHELL.EXE

	"SSPROC.ASM"のバグ

	５行程度のＥＸＥファイルが動かないよーのバグ。

	サブルーチン　EXEC_RELOC（標準ＤＯＳ実行ファイルのリロケーション）
	旧）
			MOV	CX,EXE_RELOC_CNT
		EXEC_RELOC2:
	新）
			MOV	CX,EXE_RELOC_CNT
			JCXZ	EXEC_RELOC_SKIP
		EXEC_RELOC2:

1991/03/20 PSHELL.EXE

	"READWT.ASM"のバグ（１８４８行あたり）
	
	旧）	DWRITE		DW	11110101B	; ＷＲＩＴＥ　ＤＡＴＡ
	新）	DWRITE		DW	01110101B	; ＷＲＩＴＥ　ＤＡＴＡ
		DLENW		DW	LEN_SECTOR*16	; データ長（ＤＴＬ）

1991/05/01	ＰＣ−９８０１ＵＲにバグか？

	ＤＩＳＫ−ＢＩＯＳでエラーを起こすと、トラックの管理が
	メチャメチャになるらしい。

	エラーのとき、必ずリキャブレイトすれば、大丈夫です。
	ＥＸＥＬＯＡＤは、元々そうなっているので問題ありません。
	３．５ｉｎｃｈＦＤはこういう問題が多いんですよ。

1991/05/03	ＰＣ−９８０１ＤＸの初期ロットのＲＯＭにバグか？

	ＤＩＳＫ−ＢＩＯＳ（新センスコマンド８４Ｈ）を
	ループ等で繰り返し、高速ＣＡＬＬするとＦＤの交換時に
	ハングアップします。
	こういう処理はＢＩＯＳの方でステータスをチェックして
	ＷＡＩＴして欲しいんですけど・・・。

1992/03/03	新しい読み取りアルゴリズムに読み込み時間の短縮

	新しい読み取りアルゴリズムにより平均アクセススピードが
	向上しました。

;  
;	end of "UPDATE.DOC"  
;  
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー  

ここまで  

r.h 2025/5/15  
